# configs_continuous.py
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞
import os
from pathlib import Path
from dotenv import load_dotenv

BASE_DIR = Path(__file__).resolve().parent
ENV_PATH = BASE_DIR / ".env"
if ENV_PATH.exists():
    load_dotenv(ENV_PATH)

# ============================================================================
# –û–°–ù–û–í–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ –ù–ï–ü–†–ï–†–´–í–ù–û–ì–û –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê
# ============================================================================
START_AMOUNT = float(os.getenv("START_AMOUNT", 100.0))
MIN_SPREAD = float(os.getenv("MIN_SPREAD", 0.1))  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ –¥–ª—è –≤—ã–≤–æ–¥–∞
MIN_PROFIT_USD = float(os.getenv("MIN_PROFIT_USD", 0.5))  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö
MAX_REASONABLE_SPREAD = float(os.getenv("MAX_REASONABLE_SPREAD", 50.0))

# –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 15-30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –Ω–∞–≥—Ä—É–∑–∫–∏
MONITORING_INTERVAL = float(os.getenv("MONITORING_INTERVAL", 20.0))

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–µ–∫—É–Ω–¥—ã)
# –î–∞–Ω–Ω—ã–µ BestChange –∏ Bybit –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
DATA_RELOAD_INTERVAL = int(os.getenv("DATA_RELOAD_INTERVAL", 3600))  # 1 —á–∞—Å

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –ø–æ–∫–∞–∑–æ–º –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Å–≤—è–∑–∫–∏ (—Å–µ–∫—É–Ω–¥—ã)
MIN_TIME_BETWEEN_DUPLICATE = int(os.getenv("MIN_TIME_BETWEEN_DUPLICATE", 60))

# ============================================================================
# –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ü–û –õ–ò–ö–í–ò–î–ù–û–°–¢–ò (–¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞)
# ============================================================================
MIN_24H_VOLUME_USDT = float(os.getenv("MIN_24H_VOLUME_USDT", 100000.0))
MIN_LIQUIDITY_SCORE = float(os.getenv("MIN_LIQUIDITY_SCORE", 40.0))
USE_ONLY_TOP_LIQUID_COINS = int(os.getenv("USE_ONLY_TOP_LIQUID_COINS", 200))

# ============================================================================
# –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò
# ============================================================================
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ BestChange
# –ë–æ–ª—å—à–µ = –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –≤—ã—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: —É–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 20 –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
MAX_CONCURRENT_REQUESTS = int(os.getenv("MAX_CONCURRENT_REQUESTS", 20))

# –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)
# –ú–µ–Ω—å—à–µ = –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ —Ä–∏—Å–∫ rate limit
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: —É–º–µ–Ω—å—à–µ–Ω–æ –¥–æ 0.05 –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
REQUEST_DELAY = float(os.getenv("REQUEST_DELAY", 0.05))

# –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: —É–º–µ–Ω—å—à–µ–Ω–æ –¥–æ 25 –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤
BATCH_SIZE = int(os.getenv("BATCH_SIZE", 25))

# –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
MAX_RETRIES = int(os.getenv("MAX_RETRIES", 3))
RETRY_DELAY = float(os.getenv("RETRY_DELAY", 0.5))
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: —É–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–æ 60 —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
REQUEST_TIMEOUT = int(os.getenv("REQUEST_TIMEOUT", 60))

# ============================================================================
# –ö–≠–®–ò–†–û–í–ê–ù–ò–ï –î–õ–Ø –£–°–ö–û–†–ï–ù–ò–Ø
# ============================================================================
ENABLE_CACHE = True
CACHE_HOT_PAIRS = int(os.getenv("CACHE_HOT_PAIRS", 100))  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ "–≥–æ—Ä—è—á–∏—Ö" –ø–∞—Ä
CACHE_TTL = int(os.getenv("CACHE_TTL", 300))  # –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ (—Å–µ–∫—É–Ω–¥—ã)

# ============================================================================
# WEBSOCKET (–¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ü–µ–Ω)
# ============================================================================
WEBSOCKET_ENABLED = os.getenv("WEBSOCKET_ENABLED", "True").lower() in ("true", "1", "yes")
WEBSOCKET_RECONNECT_DELAY = float(os.getenv("WEBSOCKET_RECONNECT_DELAY", 5.0))
WEBSOCKET_PING_INTERVAL = float(os.getenv("WEBSOCKET_PING_INTERVAL", 20.0))

# ============================================================================
# API –ù–ê–°–¢–†–û–ô–ö–ò
# ============================================================================
BYBIT_API_URL = os.getenv("BYBIT_API_URL", "https://api.bybit.com")
BYBIT_WS_URL = os.getenv("BYBIT_WS_URL", "wss://stream.bybit.com/v5/public/spot")
BYBIT_API_KEY = os.getenv("BYBIT_API_KEY", "")
BYBIT_API_SECRET = os.getenv("BYBIT_API_SECRET", "")

BESTCHANGE_API_KEY = os.getenv("BESTCHANGE_API_KEY", "")

if not BESTCHANGE_API_KEY:
    print("‚ö†Ô∏è  –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï: BESTCHANGE_API_KEY –Ω–µ –∑–∞–¥–∞–Ω!")
    print("    –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ API –∫–ª—é—á–∞ BestChange")
    print("    –ü–æ–ª—É—á–∏—Ç–µ –∫–ª—é—á –Ω–∞: https://www.bestchange.com/wiki/api.html")
    print("    –î–æ–±–∞–≤—å—Ç–µ –≤ .env —Ñ–∞–π–ª: BESTCHANGE_API_KEY=–≤–∞—à_–∫–ª—é—á\n")

# ============================================================================
# –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
# ============================================================================
LOGS_DIR = BASE_DIR / "logs"
LOGS_DIR.mkdir(exist_ok=True)

# –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ª–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∫–∏ –≤ —Ñ–∞–π–ª (–ø–æ–º–∏–º–æ –∫–æ–Ω—Å–æ–ª–∏)
SAVE_OPPORTUNITIES_TO_FILE = os.getenv("SAVE_OPPORTUNITIES_TO_FILE", "True").lower() in ("true", "1", "yes")
OPPORTUNITIES_LOG_FILE = LOGS_DIR / "opportunities.log"

# –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
# 0 = –º–∏–Ω–∏–º—É–º (—Ç–æ–ª—å–∫–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∫–∏)
# 1 = —Å—Ç–∞–Ω–¥–∞—Ä—Ç (+ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–∂–¥—ã–µ 10 –∏—Ç–µ—Ä–∞—Ü–∏–π)
# 2 = –º–∞–∫—Å–∏–º—É–º (+ –¥–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏)
LOG_LEVEL = int(os.getenv("LOG_LEVEL", 1))

# ============================================================================
# –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ú–û–ù–ï–¢ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# ============================================================================
BLACKLIST_COINS = set()
WHITELIST_COINS = set()
ENABLE_COIN_FILTER = False

# ============================================================================
# –†–ï–ó–£–õ–¨–¢–ê–¢–´
# ============================================================================
RESULTS_DIR = BASE_DIR / "results"
RESULTS_DIR.mkdir(exist_ok=True)

# ============================================================================
# DEBUG MODE
# ============================================================================
DEBUG = os.getenv("DEBUG", "False").lower() in ("true", "1", "yes")

# ============================================================================
# –í–´–í–û–î –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò –ü–†–ò –ó–ê–ü–£–°–ö–ï
# ============================================================================
def print_config_summary():
    """–í—ã–≤–æ–¥–∏—Ç —Å–≤–æ–¥–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
    print("\n" + "="*100)
    print("‚öôÔ∏è  –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ù–ï–ü–†–ï–†–´–í–ù–û–ì–û –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê")
    print("="*100)
    print(f"üí∞ –ù–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: ${START_AMOUNT}")
    print(f"üìä –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥: {MIN_SPREAD}%")
    print(f"üíµ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å: ${MIN_PROFIT_USD}")
    print(f"‚è±Ô∏è  –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏: {MONITORING_INTERVAL}—Å")
    print(f"üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö: –∫–∞–∂–¥—ã–µ {DATA_RELOAD_INTERVAL//60}–º–∏–Ω")
    print(f"üö´ –§–∏–ª—å—Ç—Ä –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: {MIN_TIME_BETWEEN_DUPLICATE}—Å")
    print(f"\nüíß –õ–ò–ö–í–ò–î–ù–û–°–¢–¨:")
    print(f"   ‚Ä¢ –ú–∏–Ω. –æ–±—ä–µ–º 24—á: ${MIN_24H_VOLUME_USDT:,.0f}")
    print(f"   ‚Ä¢ –ú–∏–Ω. –æ—Ü–µ–Ω–∫–∞: {MIN_LIQUIDITY_SCORE}")
    print(f"   ‚Ä¢ –¢–æ–ø –º–æ–Ω–µ—Ç: {USE_ONLY_TOP_LIQUID_COINS}")
    print(f"\n‚ö° –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:")
    print(f"   ‚Ä¢ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: {MAX_CONCURRENT_REQUESTS}")
    print(f"   ‚Ä¢ –ó–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤: {REQUEST_DELAY}—Å")
    print(f"   ‚Ä¢ –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: {BATCH_SIZE}")
    print(f"\nüîå WEBSOCKET: {'‚úÖ –í–∫–ª—é—á–µ–Ω' if WEBSOCKET_ENABLED else '‚ùå –í—ã–∫–ª—é—á–µ–Ω'}")
    print(f"üíæ –ö–≠–®–ò–†–û–í–ê–ù–ò–ï: {'‚úÖ –í–∫–ª—é—á–µ–Ω–æ' if ENABLE_CACHE else '‚ùå –í—ã–∫–ª—é—á–µ–Ω–æ'}")
    if ENABLE_CACHE:
        print(f"   ‚Ä¢ –ì–æ—Ä—è—á–∏—Ö –ø–∞—Ä: {CACHE_HOT_PAIRS}")
    print(f"\nüìù –õ–û–ì–ò–†–û–í–ê–ù–ò–ï:")
    print(f"   ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å: {LOG_LEVEL}")
    print(f"   ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª: {'–î–∞' if SAVE_OPPORTUNITIES_TO_FILE else '–ù–µ—Ç'}")
    print(f"\nüîë API –ö–õ–Æ–ß–ò:")
    print(f"   ‚Ä¢ Bybit: {'‚úÖ –ó–∞–¥–∞–Ω' if BYBIT_API_KEY else '‚ö†Ô∏è  –ù–µ –∑–∞–¥–∞–Ω (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)'}")
    print(f"   ‚Ä¢ BestChange: {'‚úÖ –ó–∞–¥–∞–Ω' if BESTCHANGE_API_KEY else '‚ùå –ù–ï –ó–ê–î–ê–ù (–ö–†–ò–¢–ò–ß–ù–û!)'}")
    print("="*100 + "\n")

def validate_config():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
    errors = []
    warnings = []
    
    if START_AMOUNT <= 0:
        errors.append("START_AMOUNT –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0")
    
    if MIN_SPREAD < 0:
        errors.append("MIN_SPREAD –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å >= 0")
    
    if MONITORING_INTERVAL < 1:
        errors.append("MONITORING_INTERVAL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å >= 1 —Å–µ–∫—É–Ω–¥—ã")
    
    if not BESTCHANGE_API_KEY:
        errors.append("BESTCHANGE_API_KEY –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞!")
    
    if MAX_CONCURRENT_REQUESTS > 1000:
        warnings.append("MAX_CONCURRENT_REQUESTS > 1000 –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ rate limiting")
    
    if REQUEST_DELAY < 0.01:
        warnings.append("REQUEST_DELAY < 0.01 –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ API")
    
    if errors:
        print("\n‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò:")
        for error in errors:
            print(f"   ‚Ä¢ {error}")
        raise ValueError("–ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º")
    
    if warnings:
        print("\n‚ö†Ô∏è  –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò:")
        for warning in warnings:
            print(f"   ‚Ä¢ {warning}")
    
    return True


if __name__ == "__main__":
    print_config_summary()
    try:
        validate_config()
        print("‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞")
    except ValueError as e:
        print(f"\n‚ùå {e}")